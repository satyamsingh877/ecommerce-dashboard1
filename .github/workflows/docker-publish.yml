name: Docker Build and Push

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  docker:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    
    - name: Docker Login
      run: |
        echo "${{ secrets.DOCKER_TOKEN }}" | docker login -u "${{ secrets.DOCKER_USERNAME }}" --password-stdin
    
    - name: Build Docker Image
      run: |
        docker build -t ${{ secrets.DOCKER_USERNAME }}/ecommerce-dashboard1:latest .
        docker tag ${{ secrets.DOCKER_USERNAME }}/ecommerce-dashboard1:latest ${{ secrets.DOCKER_USERNAME }}/ecommerce-dashboard1:${{ github.sha }}
    
    - name: Push Docker Image
      run: |
        docker push ${{ secrets.DOCKER_USERNAME }}/ecommerce-dashboard1:latest
        docker push ${{ secrets.DOCKER_USERNAME }}/ecommerce-dashboard1:${{ github.sha }}
    
    - name: Test Docker Image
      run: |
        echo "‚úÖ Image pushed successfully!"
        echo ""
        echo "üì¶ Image Info:"
        echo "  Name: ${{ secrets.DOCKER_USERNAME }}/ecommerce-dashboard1"
        echo "  Tags: latest, ${{ github.sha }}"
        echo ""
        echo "üöÄ Run locally with:"
        echo "  docker run -p 9000:9000 ${{ secrets.DOCKER_USERNAME }}/ecommerce-dashboard1:latest"
        echo ""
        echo "üåê Access at: http://localhost:9000"
